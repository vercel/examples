/**
 * vercel.ts â€” Code-based alternative to project routes
 *
 * If you prefer to manage the rewrite in code rather than through the
 * Vercel Dashboard or CLI, rename this file to `vercel.ts` and redeploy.
 *
 * Set the API_URL environment variable in your Vercel project settings
 * to point to your backend API.
 *
 * Note: Changes to this file require a new deployment. If you need
 * instant updates without redeploying, use project routes instead:
 * https://vercel.com/docs/routing/project-routing-rules
 */
import { routes, type VercelConfig } from '@vercel/config/v1'

const API_URL = process.env.API_URL || 'https://jsonplaceholder.typicode.com'

export const config: VercelConfig = {
  // Rewrite /api/external/* to the external API
  rewrites: [
    routes.rewrite('/api/external/:match*', `${API_URL}/:match*`),
  ],

  // Set CDN caching headers and cache tag on API responses
  headers: [
    routes.header('/api/external/:match*', [
      {
        key: 'CDN-Cache-Control',
        value: 'public, max-age=60, stale-while-revalidate=3600',
      },
      { key: 'Vercel-Cache-Tag', value: 'api' },
    ]),
  ],
}
